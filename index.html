<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="박진성 ❤️ 정수현의 결혼식에 초대합니다">
    <meta property="og:description" content="2026년 5월 16일(토), 저희 두 사람 시작합니다.">
    <meta property="og:image" content="https://danhopark.github.io/wedding-invitation/images/poster.jpg">
    <meta property="og:url" content="https://danhopark.github.io/wedding-invitation/">

    <title>박진성 & 정수현 모바일 청첩장</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    
    <style>
        /* 상단 <style> 태그 안에 추가 */
        input, textarea, button, p, span {
        font-family: 'Noto Sans KR', sans-serif !important;
        }

        /* 상단 <style> 안에 추가 */
        .section, footer {
        max-width: 480px; /* PC에서도 최대 480px만 차지하도록 고정 */
        margin-left: auto;
        margin-right: auto;
}
        
        /* --- 공통 스타일 --- */
        body { margin: 0; padding: 0; font-family: 'Noto Sans KR', sans-serif; background-color: #f4f4f4; color: #333; touch-action: pan-y; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .wrapper { max-width: 480px; margin: 0 auto; background: #fff; min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.05); position: relative; }
        .section { padding: 80px 20px; text-align: center; }
        h3 { font-weight: 400; letter-spacing: 2px; color: #8a7b6a; margin-bottom: 30px; font-size: 1.1rem; }
        hr { border:none; border-top:1px solid #eee; margin:0 20px; }

        

        /* 스크롤 애니메이션 */
        .reveal { opacity: 0; transform: translateY(40px); transition: all 1.2s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }
        
        /* 음악 버튼 */
        .music-btn { position: fixed; top: 20px; right: 20px; z-index: 1000; background: rgba(255,255,255,0.8); border-radius: 50%; width: 40px; height: 40px; border: 1px solid #eee; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        /* 헤더 & 포스터 */
        header { padding: 120px 20px 80px; background: #fffaf7; text-align: center; }
        .date-top { font-size: 1rem; color: #999; letter-spacing: 5px; margin-bottom: 20px; }
        .names { font-size: 2rem; margin: 25px 0; font-weight: 300; letter-spacing: 3px; }
        .main-poster { width: 100%; line-height: 0; }
        .main-poster img { width: 100%; height: auto; display: block; }

        /* 부모님 섹션 전체 스타일 */
        .parents-section {
        padding: 30px 0 60px;
        line-height: 2.5; /* 줄 간격을 넓게 해서 가독성을 높입니다 */
        }

        .family-line {
        font-size: 0.95rem;
        color: #555;
        /* [포인트] 인사말과 다른 서체(명조체)를 적용합니다 */
        font-family: 'GyeonggiBatang', 'Nanum Myeongjo', serif; 
        }

        .parents-names {
        letter-spacing: 2px;
        }

        .relation {
        font-size: 0.8rem;
        color: #999;
        margin: 0 10px;
        }

        .bride-groom-name {
        font-size: 1.05rem;
        font-weight: bold;
        color: #333;
        }

        
        /* 갤러리 (중앙 정렬 복구) */
        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 0 15px; justify-items: center; align-items: center; }
        .heart-box { aspect-ratio: 1 / 1; width: 100%; max-width: 130px; cursor: pointer; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.08)); }
        .heart-box img { width: 100%; height: 100%; object-fit: cover; clip-path: url(#heartClip); pointer-events: none; }

        /* 팝업 모달 (중앙 정렬 복구) */
        #imageModal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.98); }
        .close-btn { position: absolute; top: 20px; right: 20px; color: #fff; font-size: 40px; cursor: pointer; z-index: 2002; }
        .modalSwiper { width: 100%; height: 100%; }
        .modalSwiper .swiper-slide { display: flex !important; align-items: center !important; justify-content: center !important; }
        .modalSwiper .swiper-slide img { max-width: 100%; max-height: 85vh; object-fit: contain; pointer-events: none; }
        .swiper-button-next, .swiper-button-prev { color: rgba(255,255,255,0.7); transform: scale(0.6); }

        /* 참석 여부 폼 */
        .rsvp-form { text-align: left; max-width: 350px; margin: 0 auto; background: #fff; padding: 30px 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .rsvp-form label { font-size: 0.85rem; color: #8a7b6a; font-weight: bold; }
        .rsvp-form input[type="text"], .rsvp-form select { width: 100%; padding: 12px; margin: 8px 0 18px; border: 1px solid #eee; border-radius: 6px; box-sizing: border-box; }
        .btn-submit { width: 100%; padding: 16px; background: #8a7b6a; color: #fff; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1rem; margin-top: 10px; }

        /* 달력 & D-day */
        .calendar-wrap { margin: 0 auto; max-width: 350px; background: #fdfaf7; padding: 30px 15px; border-radius: 15px; }
        .d-day-tag { display: inline-block; background: #8a7b6a; color: #fff; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; margin-bottom: 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; font-size: 0.85rem; }
        .weekday { font-weight: bold; color: #bbb; padding-bottom: 12px; }
        .day { padding: 10px 0; }
        .sun { color: #e74c3c; }
        .d-day-circle { background-color: #8a7b6a; color: #fff; border-radius: 50%; font-weight: bold; }

        /* 지도 (고정 크기 복구) */
        #map { width: 100%; height: 300px; margin: 25px 0; border-radius: 8px; border: 1px solid #eee; }
        .map-btns { display: flex; gap: 10px; justify-content: center; }
        .btn-map { padding: 12px; background: #fff; border: 1px solid #ddd; border-radius: 6px; text-decoration: none; color: #555; font-size: 0.85rem; flex: 1; max-width: 130px; }
        
        /* 계좌번호 */
        .account-box { margin-bottom: 15px; border: 1px solid #eee; border-radius: 8px; overflow: hidden; background: #fff; }
        .toggle-btn { width: 100%; padding: 18px; background: #fdfdfd; border: none; cursor: pointer; display: flex; justify-content: space-between; font-size: 0.95rem; color: #666; }
        .account-details { display: none; padding: 25px; background: #fafafa; text-align: left; font-size: 0.9rem; line-height: 2.2; border-top: 1px solid #eee; }
        .copy-btn { padding: 4px 10px; font-size: 0.75rem; background: #f0f0f0; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px; color: #666; }

        footer { padding: 80px 20px; font-size: 0.85rem; color: #bbb; background: #fdfaf7; text-align: center; }
          /* 방명록 줄바꿈 유지 */
        #guestbook-list div { white-space: pre-wrap; word-break: break-all; }
   
   </style>
</head>
<body>

<svg width="0" height="0" style="position:absolute; pointer-events:none;">
    <defs>
        <clipPath id="heartClip" clipPathUnits="objectBoundingBox">
            <path d="M0.5,0.95 C0.5,0.95 0.05,0.65 0.05,0.35 C0.05,0.15 0.2,0.05 0.35,0.05 C0.45,0.05 0.5,0.15 0.5,0.15 C0.5,0.15 0.55,0.05 0.65,0.05 C0.8,0.05 0.95,0.15 0.95,0.35 C0.95,0.65 0.5,0.95 0.5,0.95 Z" />
        </clipPath>
    </defs>
</svg>

<div id="imageModal">
    <span class="close-btn" onclick="closeModal()">&times;</span>
    <div class="swiper modalSwiper">
        <div class="swiper-wrapper" id="modalWrapper"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>
</div>

<div class="wrapper">
    <div class="music-btn" onclick="toggleMusic()">
        <span id="musicIcon">▶️</span>
        <audio id="bgm" src="music/bgm.mp3" loop autoplay playsinline></audio>
    </div>

    <header>
        <p class="date-top">2026 . 05 . 16</p>
        <h1 class="names">박진성 & 정수현</h1>
        <p style="line-height:2; color:#666; font-size:0.95rem;">
            <br>갑작스레 소나기가 쏟아지던 첫 만남
            <br>작은 우산 아래 맞닿던 어깨, 어색한 미소
            <br>그렇게 사랑을 키워온 저희가
            <br>이제는 하나님 안에서 하나가 되고자 합니다.
            <br>
            <br>이 신실한 약속의 자리에 동행하시어
            <br>함께 축복해주시길 소망합니다.

        <div class="parents-section reveal">
        <div class="family-line">
        <span class="parents-names">박병재 · 강은주</span>
        <span class="relation">의 아들</span>
        <span class="bride-groom-name">진성</span>
    </div>
    <div class="family-line">
        <span class="parents-names">정병권 · 황은순</span>
        <span class="relation">의&nbsp;&nbsp;&nbsp;&nbsp;딸</span>
        <span class="bride-groom-name">수현</span>
    </div>
        </p>

     
</div>
    </header>

    <div class="main-poster reveal">
        <img src="images/poster.jpg" alt="메인 포스터">
    </div>

    <hr>
<div class="section reveal">
    <h3>GALLERY</h3>
    <div class="gallery-grid" id="originalGallery">
        <div class="heart-box" onclick="openModal(0)"><img src="images/photo1.jpg"></div>
        <div class="heart-box" onclick="openModal(1)"><img src="images/photo2.jpg"></div>
        <div class="heart-box" onclick="openModal(2)"><img src="images/photo3.jpg"></div>
        <div class="heart-box" onclick="openModal(3)"><img src="images/photo4.jpg"></div>
        <div class="heart-box" onclick="openModal(4)"><img src="images/photo5.jpg"></div>
        <div class="heart-box" onclick="openModal(5)"><img src="images/photo6.jpg"></div>
        <div class="heart-box" onclick="openModal(6)"><img src="images/photo7.jpg"></div>
        <div class="heart-box" onclick="openModal(7)"><img src="images/photo8.jpg"></div>
        <div class="heart-box" onclick="openModal(8)"><img src="images/photo9.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(9)" style="display: none;"><img src="images/photo10.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(10)" style="display: none;"><img src="images/photo11.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(11)" style="display: none;"><img src="images/photo12.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(12)" style="display: none;"><img src="images/photo13.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(13)" style="display: none;"><img src="images/photo14.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(14)" style="display: none;"><img src="images/photo15.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(15)" style="display: none;"><img src="images/photo16.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(16)" style="display: none;"><img src="images/photo17.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(17)" style="display: none;"><img src="images/photo18.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(18)" style="display: none;"><img src="images/photo19.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(19)" style="display: none;"><img src="images/photo20.jpg"></div>
        <div class="heart-box more-photo" onclick="openModal(20)" style="display: none;"><img src="images/photo21.jpg"></div>
    </div>

    <button id="gallery-toggle-btn" onclick="toggleGallery()" style="margin-top: 30px; padding: 10px 20px; background: none; border: 1px solid #8a7b6a; color: #8a7b6a; border-radius: 20px; font-size: 0.85rem; cursor: pointer;">
        사진 더 보기 ∨
    </button>
</div>



    </div>

    <div class="section reveal" style="background: #fffaf7;">
        <h3>참석 여부</h3>
        <div class="rsvp-form">
            <form id="rsvpForm">
                <label>성함</label>
                <input type="text" id="rsvp-name" placeholder="성함을 입력해주세요" required>
                
                <label>참석 여부</label>
                <div style="margin: 10px 0 20px;">
                    <input type="radio" name="attendance" value="참석" id="att-yes" onclick="toggleRSVP(true)"> <label for="att-yes" style="margin-right: 15px;">참석</label>
                    <input type="radio" name="attendance" value="미정" id="att-mid" onclick="toggleRSVP(true)"> <label for="att-mid" style="margin-right: 15px;">미정</label>
                    <input type="radio" name="attendance" value="불참" id="att-no" onclick="toggleRSVP(false)"> <label for="att-no">불참</label>
                </div>

               <div id="additional-rsvp" style="display:none;">
    <label>참석 인원 (본인 포함)</label>
    <select id="rsvp-count">
        <option value="1">1명</option>
        <option value="2">2명</option>
        <option value="3">3명</option>
        <option value="4">4명</option>
        <option value="5">5명</option>
    </select>
    
    <label>식사 여부</label>
    <select id="rsvp-meal">
        <option value="O">식사 예정</option>
        <option value="X">식사 안함</option>
    </select>
                </div>
                
                <button type="button" class="btn-submit" onclick="submitRSVP()">참석 명단 등록하기</button>
            </form>
        </div>
    </div>

    <div class="section reveal">
        <h3>CALENDAR</h3>
        <div class="calendar-wrap">
            <div id="d-day-count" class="d-day-tag">D-Day</div>
            <div class="calendar-header">2026. 05. 16. SAT</div>
            <div class="calendar-grid" id="calendar-area"></div>
        </div>
    </div>

    <div class="section reveal">
        <h3>LOCATION</h3>
        <p><strong>여수 마리나 웨딩홀</strong></p>
        <p style="font-size: 0.85rem; color: #888;">전남 여수시 선소로 25</p>
        <div id="map"></div>
        <div class="map-btns">
            <a href="https://map.kakao.com/link/to/여수마리나웨딩홀,34.756854435255,127.66424876634" class="btn-map" target="_blank">카카오맵</a>
            <a href="https://map.naver.com/v5/search/여수마리나웨딩홀" class="btn-map" target="_blank">네이버 지도</a>
        </div>
    </div>

    <hr>

    <div class="section reveal" style="background: #fdfaf7;">
        <h3>마음 전하실 곳</h3>
        <div class="account-box">
            <button class="toggle-btn" onclick="toggleAccount('groom')"><span>신랑측 계좌번호</span> <span id="groom-arrow">▼</span></button>
            <div id="groom-details" class="account-details">
                <p>신랑 박진성 <br> <strong>국민 123-456-7890</strong> <button class="copy-btn" onclick="copyAccount('123-456-7890')">복사</button></p>
                <p>신랑 박진성 <br> <strong>국민 123-456-7890</strong> <button class="copy-btn" onclick="copyAccount('123-456-7890')">복사</button></p>
                <p>신랑 박진성 <br> <strong>국민 123-456-7890</strong> <button class="copy-btn" onclick="copyAccount('123-456-7890')">복사</button></p>
          
             </div>
        </div>
        <div class="account-box">
            <button class="toggle-btn" onclick="toggleAccount('bride')"><span>신부측 계좌번호</span> <span id="bride-arrow">▼</span></button>
            <div id="bride-details" class="account-details">
                <p>신부 정수현 <br> <strong>우리 111-222-3333</strong> <button class="copy-btn" onclick="copyAccount('111-222-3333')">복사</button></p>
                <p>신부 정수현 <br> <strong>우리 111-222-3333</strong> <button class="copy-btn" onclick="copyAccount('111-222-3333')">복사</button></p>
                <p>신부 정수현 <br> <strong>우리 111-222-3333</strong> <button class="copy-btn" onclick="copyAccount('111-222-3333')">복사</button></p>
            </div>
        </div>
    </div>

<div class="section reveal">
    <h3>GUESTBOOK</h3>
    
    <div style="max-width: 400px; margin: 0 auto 40px; background: #fafafa; padding: 20px; border-radius: 12px; text-align: left;">
        <label style="font-size: 0.8rem; color: #8a7b6a; font-weight: bold;">닉네임</label>
        <input type="text" id="gb-nickname" placeholder="방명록에 표시될 이름" style="width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;">
        
        <label style="font-size: 0.8rem; color: #8a7b6a; font-weight: bold;">축하 메시지</label>
 <textarea id="gb-message" placeholder="축하의 한마디를 남겨주세요." style="width: 100%; height: 80px; padding: 10px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; resize: none; font-family: inherit;"></textarea>
        
        <button type="button" onclick="submitGuestbook()" style="width: 100%; padding: 12px; background: #8a7b6a; color: #fff; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">메시지 남기기</button>
    </div>

    <div id="guestbook-list" style="max-width: 400px; margin: 0 auto; text-align: left;">
        <p style="text-align: center; color: #ccc;">메시지를 불러오는 중입니다...</p>
    </div>
</div>

    <footer><p>© 2026 Jinseong & Suhyun</p></footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=0ebf1ad76dafaaef0163552b448e5e8a"></script>

<script>
    /* 1. 스크롤 애니메이션 */
    function reveal() {
        var reveals = document.querySelectorAll(".reveal");
        for (var i = 0; i < reveals.length; i++) {
            var windowHeight = window.innerHeight;
            var elementTop = reveals[i].getBoundingClientRect().top;
            if (elementTop < windowHeight - 100) reveals[i].classList.add("active");
        }
    }
    window.addEventListener("scroll", reveal); window.addEventListener("load", reveal);

    /* 2. 갤러리 팝업 & 중앙 정렬 보정 */
    var modalSwiper;
    window.addEventListener('load', function() {
        const modalWrapper = document.getElementById('modalWrapper');
        const originalImages = document.querySelectorAll('#originalGallery .heart-box img');
        originalImages.forEach(img => {
            const slide = document.createElement('div'); slide.className = 'swiper-slide';
            const newImg = document.createElement('img'); newImg.src = img.src;
            slide.appendChild(newImg); modalWrapper.appendChild(slide);
        });
        modalSwiper = new Swiper(".modalSwiper", { 
            spaceBetween: 20, 
            navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
            observer: true, 
            observeParents: true 
        });
    });
    function openModal(index) {
        document.getElementById("imageModal").style.display = "block";
        document.body.style.overflow = "hidden";
        if (modalSwiper) modalSwiper.slideTo(index, 0);
    }
    function closeModal() { document.getElementById("imageModal").style.display = "none"; document.body.style.overflow = "auto"; }

    /* 3. RSVP 조건부 노출 & 데이터 전송 */
    function toggleRSVP(show) { 
        document.getElementById('additional-rsvp').style.display = show ? 'block' : 'none'; 
    }
    
 function submitRSVP() {
    // 1. [체크] 주소 끝이 formResponse 인지 다시 확인!
    const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSf5jUd7mNWI976uVeXp5YBqitXLrtTEyeIf0AUtUH3vE8Hmbg/formResponse";
    
    const name = document.getElementById("rsvp-name").value;
    const attendance = document.querySelector('input[name="attendance"]:checked')?.value;
    
    if (!name || !attendance) { alert("성함과 참석 여부를 선택해주세요."); return; }

    const formData = new FormData();
    formData.append("entry.29244752", name);             // 성함
    formData.append("entry.1798204085", attendance);     // 참석/불참/미정

    // [중요] 불참이 아닐 때만 인원과 식사 정보 전송
    if (attendance !== "불참") {
        // 인원 선택지의 value가 "1", "2" 처럼 숫자만 있어야 합니다.
        formData.append("entry.1424019092", document.getElementById("rsvp-count").value); 
        // 식사 여부의 value는 "O" 또는 "X" 여야 합니다.
        formData.append("entry.515197960", document.getElementById("rsvp-meal").value);   
    }

    fetch(formUrl, { method: "POST", mode: "no-cors", body: formData }).then(() => {
        alert("소중한 정보가 전달되었습니다. 감사합니다!");
        document.getElementById("rsvpForm").reset();
        toggleRSVP(false);
    }).catch(() => alert("전송 오류가 발생했습니다."));
}

    /* 4. 달력 복구 */
    function initCalendar() {
        const weddingDate = new Date("2026-05-16"); const today = new Date();
        today.setHours(0,0,0,0); weddingDate.setHours(0,0,0,0);
        const diff = weddingDate - today;
        const dDay = Math.ceil(diff / (1000 * 60 * 60 * 24));
        document.getElementById('d-day-count').innerText = dDay > 0 ? "D-" + dDay : (dDay === 0 ? "D-Day" : "D+" + Math.abs(dDay));
        const area = document.getElementById('calendar-area');
        let html = '<div class="weekday sun">일</div><div class="weekday">월</div><div class="weekday">화</div><div class="weekday">수</div><div class="weekday">목</div><div class="weekday">금</div><div class="weekday">토</div>';
        for (let i = 0; i < 5; i++) html += '<div class="day"></div>'; 
        for (let d = 1; d <= 31; d++) {
            let cls = 'day'; if (d === 16) cls += ' d-day-circle'; else if ((d + 5) % 7 === 1) cls += ' sun';
            html += `<div class="${cls}">${d}</div>`;
        }
        area.innerHTML = html;
    }
    initCalendar();

    

    /* 5. 지도 & 음악 & 계좌 */
    var hallLoc = new kakao.maps.LatLng(34.756854435255, 127.66424876634);
    var map = new kakao.maps.Map(document.getElementById('map'), { center: hallLoc, level: 3 });
    new kakao.maps.Marker({ position: hallLoc }).setMap(map);
    map.setDraggable(false); map.setZoomable(false);

    const bgm = document.getElementById('bgm'); const mIcon = document.getElementById('musicIcon');
    bgm.volume = 0.3;
    window.addEventListener('load', () => {
        bgm.play().then(() => mIcon.innerText = "⏸️").catch(() => {
            const startBgm = () => { bgm.play(); mIcon.innerText = "⏸️"; document.removeEventListener('click', startBgm); };
            document.addEventListener('click', startBgm); document.addEventListener('touchstart', startBgm);
        });
    });
    function toggleMusic() { if (bgm.paused) { bgm.play(); mIcon.innerText = "⏸️"; } else { bgm.pause(); mIcon.innerText = "▶️"; } }
    function toggleAccount(t) {
        const d = document.getElementById(t + '-details'); const a = document.getElementById(t + '-arrow');
        const isShow = d.style.display === "block"; d.style.display = isShow ? "none" : "block"; a.innerText = isShow ? "▼" : "▲";
    }
    function copyAccount(num) { navigator.clipboard.writeText(num).then(() => alert("계좌번호가 복사되었습니다.")); }

/* 6. 구글 시트 방명록 연동 */
const G_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSfmPPZX_sGo5pQ9JE2pmDPQioTcFBUVMCTHf40BP3Hi3HrUN_zVYOFGqi-BiX3wJu_IdVOCiNCLdXm/pub?output=csv";

async function fetchGuestbook() {
    try {
        const response = await fetch(G_SHEET_CSV_URL);
        const data = await response.text();
        const rows = data.split("\n").slice(1); 
        const listContainer = document.getElementById('guestbook-list');
        listContainer.innerHTML = ''; 

        let hasMessage = false;

        rows.reverse().forEach(row => {
            const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); 
            const nickname = cols[1]?.replace(/"/g, "").trim();
            const message = cols[2]?.replace(/"/g, "").trim();

            if (nickname && message) {
                hasMessage = true;
                const item = document.createElement('div');
                item.style.cssText = "background: #fdfaf7; padding: 18px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #f0ede9;";
                item.innerHTML = `
                    <div style="font-weight: bold; font-size: 0.9rem; color: #8a7b6a; margin-bottom: 8px;">✨ ${nickname}</div>
                    <div style="font-size: 0.85rem; color: #555; line-height: 1.6; white-space: pre-wrap;">${message}</div>
                `;
                listContainer.appendChild(item);
            }
        });

        if (!hasMessage) {
            listContainer.innerHTML = '<p style="text-align: center; color: #ccc; padding: 40px 0;">첫 번째 축하 메시지를 남겨주세요!</p>';
        }
    } catch (e) {
        console.error("방명록 로딩 실패", e);
    }
}

// 페이지 로드 시 방명록 불러오기 실행
window.addEventListener('load', fetchGuestbook);

/* 7. 방명록 인페이지 전송 및 불러오기 통합 로직 */

// [확인] 새로 만드신 방명록 전용 구글 폼의 주소로 바꿔주세요! (끝이 formResponse여야 합니다)
const GB_FORM_URL = "https://docs.google.com/forms/d/1Rhnk0ETTKMJ3w4b1UmIYtpD3atnZrYP3v5bV34P5Ru4/formResponse"; 
const GB_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSfmPPZX_sGo5pQ9JE2pmDPQioTcFBUVMCTHf40BP3Hi3HrUN_zVYOFGqi-BiX3wJu_IdVOCiNCLdXm/pub?output=csv";

// 방명록 전송 함수
function submitGuestbook() {
    const nickname = document.getElementById("gb-nickname").value;
    const message = document.getElementById("gb-message").value;

    if (!nickname || !message) { 
        alert("닉네임과 메시지를 모두 입력해 주세요."); 
        return; 
    }

    const formData = new FormData();
    // 방금 찾은 따끈따끈한 번호들입니다!
    formData.append("entry.1626987351", nickname); // 성함(닉네임)
    formData.append("entry.1908824385", message);  // 축하 메세지

    fetch(GB_FORM_URL, { method: "POST", mode: "no-cors", body: formData })
    .then(() => {
        alert("소중한 축하 메시지가 등록되었습니다!\n(데이터 반영까지 1~2분 정도 소요될 수 있습니다.)");
        // 입력창 비우기
        document.getElementById("gb-nickname").value = "";
        document.getElementById("gb-message").value = "";
    })
    .catch(() => alert("전송 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요."));
}

// 방명록 목록 불러오기 함수 (기존 로직 유지)
async function fetchGuestbook() {
    try {
        const response = await fetch(GB_CSV_URL);
        const data = await response.text();
        const rows = data.split("\n").slice(1); 
        const listContainer = document.getElementById('guestbook-list');
        listContainer.innerHTML = ''; 

        let hasMessage = false;

        rows.reverse().forEach(row => {
            const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/); 
            const name = cols[1]?.replace(/"/g, "").trim();
            const msg = cols[2]?.replace(/"/g, "").trim();

            if (name && msg) {
                hasMessage = true;
                const item = document.createElement('div');
                item.style.cssText = "background: #fdfaf7; padding: 18px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #f0ede9;";
                item.innerHTML = `
                    <div style="font-weight: bold; font-size: 0.9rem; color: #8a7b6a; margin-bottom: 8px;">✨ ${name}</div>
                    <div style="font-size: 0.85rem; color: #555; line-height: 1.6; white-space: pre-wrap;">${msg}</div>
                `;
                listContainer.appendChild(item);
            }
        });

        if (!hasMessage) {
            listContainer.innerHTML = '<p style="text-align: center; color: #ccc; padding: 40px 0;">첫 번째 축하 메시지를 남겨주세요!</p>';
        }
    } catch (e) {
        console.error("방명록 로딩 실패", e);
    }
}

window.addEventListener('load', fetchGuestbook);

function toggleGallery() {
    const morePhotos = document.querySelectorAll('.more-photo');
    const btn = document.getElementById('gallery-toggle-btn');
    const isHidden = morePhotos[0].style.display === 'none';

    if (isHidden) {
        // 사진 펼치기
        morePhotos.forEach(photo => {
            photo.style.display = 'block';
        });
        btn.innerText = '사진 접기 ∧';
    } else {
        // 사진 접기
        morePhotos.forEach(photo => {
            photo.style.display = 'none';
        });
        btn.innerText = '사진 더 보기 ∨';
        
        // 접었을 때 갤러리 위치로 스크롤 이동 (선택 사항)
        document.getElementById('originalGallery').scrollIntoView({ behavior: 'smooth' });
    }
}


</script>
</body>
</html>
